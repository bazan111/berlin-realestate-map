<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berlin Real Estate Map</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #login-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        #login-box { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); text-align: center; }
        #map-container { display: none; position: relative; width: 100%; height: 100vh; }
        #map { position: absolute; top: 0; bottom: 0; left: 0; right: 350px; }
        #info-panel { position: absolute; top: 0; right: 0; width: 350px; height: 100%; background: white; padding: 20px; box-shadow: -2px 0 5px rgba(0,0,0,0.1); overflow-y: auto; }
        #user-profile { position: absolute; top: 10px; right: 370px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: none; align-items: center; gap: 10px; z-index: 1000; }
        #user-profile img { width: 40px; height: 40px; border-radius: 50%; }
        #logout-btn { background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .district-item { padding: 10px; margin: 10px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer; transition: background 0.3s; }
        .district-item:hover { background: #e9ecef; }
        .price { font-weight: bold; color: #28a745; }
    </style>
</head>
<body>
    <div id="login-container">
        <div id="login-box">
            <h1>Berlin Real Estate Map</h1>
            <p>Please sign in with Google to view the map</p>
            <div id="g_id_onload" data-client_id="YOUR_GOOGLE_CLIENT_ID" data-callback="handleCredentialResponse"></div>
            <div class="g_id_signin" data-type="standard"></div>
        </div>
    </div>
    <div id="map-container">
        <div id="user-profile">
            <img id="user-photo" src="" alt="User">
            <div>
                <div id="user-name"></div>
                <div id="user-email" style="font-size: 12px; color: #666;"></div>
            </div>
            <button id="logout-btn" onclick="handleLogout()">Logout</button>
        </div>
        <div id="map"></div>
        <div id="info-panel">
            <h2>Berlin Real Estate 2025</h2>
            <p>Click districts to view details</p>
            <div id="district-list"></div>
        </div>
    </div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiYmF6YW4xMTEiLCJhIjoiY20wamZkNnd5MGduNzJrcXd4aHdidGVsbSJ9.Wso7apo98Cs5kHuN_jvUVw';
        let map;
        const districts = [
            { name: 'Mitte', price: 6500, lat: 52.5200, lon: 13.4050 },
            { name: 'Charlottenburg', price: 5800, lat: 52.5050, lon: 13.2900 },
            { name: 'Pankow', price: 4900, lat: 52.5700, lon: 13.4000 },
            { name: 'Friedrichshain', price: 5600, lat: 52.5000, lon: 13.4300 },
            { name: 'Tempelhof', price: 5200, lat: 52.4700, lon: 13.3800 },
            { name: 'Steglitz', price: 5500, lat: 52.4400, lon: 13.2400 },
            { name: 'Neukölln', price: 4500, lat: 52.4800, lon: 13.4300 },
            { name: 'Treptow', price: 4200, lat: 52.4500, lon: 13.5700 },
            { name: 'Marzahn', price: 3200, lat: 52.5400, lon: 13.6000 },
            { name: 'Lichtenberg', price: 3800, lat: 52.5200, lon: 13.4900 },
            { name: 'Reinickendorf', price: 4300, lat: 52.5700, lon: 13.3300 },
            { name: 'Spandau', price: 3900, lat: 52.5400, lon: 13.2000 }
        ];
        function handleCredentialResponse(response) {
            const userInfo = parseJwt(response.credential);
            document.getElementById('user-name').textContent = userInfo.name;
            document.getElementById('user-email').textContent = userInfo.email;
            document.getElementById('user-photo').src = userInfo.picture;
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('map-container').style.display = 'block';
            document.getElementById('user-profile').style.display = 'flex';
            initMap();
        }
        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
            return JSON.parse(jsonPayload);
        }
        function handleLogout() {
            location.reload();
        }
        function initMap() {
            map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v12',
                center: [13.4050, 52.5200],
                zoom: 10
            });
            map.addControl(new mapboxgl.NavigationControl());
            districts.forEach(district => {
                new mapboxgl.Marker({ color: getColor(district.price) })
                    .setLngLat([district.lon, district.lat])
                    .setPopup(new mapboxgl.Popup().setHTML(`<h3>${district.name}</h3><p class="price">€${district.price}/m²</p>`))
                    .addTo(map);
                const div = document.createElement('div');
                div.className = 'district-item';
                div.innerHTML = `<strong>${district.name}</strong><br><span class="price">€${district.price}/m²</span>`;
                div.onclick = () => map.flyTo({ center: [district.lon, district.lat], zoom: 12 });
                document.getElementById('district-list').appendChild(div);
            });
        }
        function getColor(price) {
            if (price >= 6000) return '#dc3545';
            if (price >= 5000) return '#fd7e14';
            if (price >= 4000) return '#ffc107';
            return '#28a745';
        }
    </script>
</body>
</html>
